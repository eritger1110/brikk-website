<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Verifying… • Brikk</title>
  <script src="/public/config.js?v=2"></script>
  <style>
    :root{color-scheme:dark}
    body{margin:0;display:grid;place-items:center;min-height:100vh;background:#0b0f1a;color:#e7ecff;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif}
    .card{background:#0f1629;border:1px solid #1c2541;border-radius:16px;padding:24px;width:min(600px,90vw)}
    .muted{color:#98b0d9}.ok{color:#70ffa7}.err{color:#ff708d}
    a.btn{display:inline-block;margin-top:14px;background:#635bff;color:#fff;padding:.6rem 1rem;border-radius:10px;text-decoration:none;font-weight:600}
    code{word-break:break-all}
  </style>
</head>
<body>
  <div class="card">
    <h2>Verifying your email…</h2>
    <div id="status" class="muted">Please wait.</div>
    <div id="action"></div>
    <div id="dbg" class="muted" style="margin-top:10px;font-size:13px"></div>
  </div>

<script>
const API = (window.__BRIKK_API__ || "https://api.getbrikk.com").replace(/\/+$/,"");
const params = new URLSearchParams(location.search);
const token = params.get("token");

function msg(html, cls=""){ const el=document.getElementById("status"); el.className=cls||"muted"; el.innerHTML=html; }
function dbg(s){ document.getElementById("dbg").innerHTML = s; }

async function run(){
  if(!token){ msg("Missing token.", "err"); return; }

  const url = `${API}/api/auth/verify?token=${encodeURIComponent(token)}`;
  dbg(`Calling <code>GET ${url}</code>`);

  try{
    // Force GET. Do not set headers that trigger preflight.
    const r = await fetch(url, { method: "GET", credentials: "include", cache: "no-store" });
    const data = await r.json().catch(()=>({}));
    if(!r.ok || !data.ok){
      msg(`Could not verify: ${data.error || "Unknown error"}`, "err");
      return;
    }
    msg("Your email has been verified. You can return to the app.", "ok");
    document.getElementById('action').innerHTML = `<a class="btn" href="/app/">Go to Dashboard</a>`;
  }catch(e){
    msg("Network error verifying token.", "err");
  }
}
run();
</script>
</body>
</html>
